---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# pregnancy <a href="https://ellakaye.github.io/pregnancy/"><img src="man/figures/logo.png" align="right" height="137" alt="pregnancy website" /></a>

<!-- badges: start -->
[![R-CMD-check](https://github.com/EllaKaye/pregnancy/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/EllaKaye/pregnancy/actions/workflows/R-CMD-check.yaml)
[![Codecov test coverage](https://codecov.io/gh/EllaKaye/pregnancy/branch/main/graph/badge.svg)](https://app.codecov.io/gh/EllaKaye/pregnancy?branch=main)
<!-- badges: end -->

This is a work-in-progress R package for calculating dates and tracking medications during pregnancy and fertility treatment. 
It extends a private, personal package that I wrote for myself when I was pregnant, 
It contains functions and features that I found useful at the time, and others that I added when adapting the package for general use.

> This R package is in the latter stages of development, with a view to release by mid-March 2025.
> The main functionality is now in place.
> Still to do: improved documentation, vignette(s), better test coverage, improve some of messages in some utils functions.

## Installation 

You can install the development version of pregnancy from [GitHub](https://github.com/) with: 

``` r 
# install.packages("remotes") 
remotes::install_github("EllaKaye/pregnancy") 
```

## Usage

```{r}
library(pregnancy)
```

## Date calculations

The `calculate_due_date()` function estimates the pregnancy due date. 
The `start_date` is interpreted differently, depending on the `start_type`. 
By default, the `start_type` is the last menstrual period, and the `start_date` is the date this started.
Other `start_date` options, like various transfer days, are useful for those using IVF.

```{r}
due_date <- calculate_due_date(as.Date("2024-12-10"))
```

Once a due date is know, the `how_far()` function tells you how far into the pregnancy you are on a given date.
It defaults to providing this information for the current date, 
but an alternative `on_date` can be provided. 
This README was built on **`r format(Sys.Date(), '%B %d, %Y')`**, 
so for the purposes of reading this page, that counts as "today".

```{r}
how_far(due_date = due_date)
how_far(on_date = as.Date("2025-04-02"), due_date = due_date)
```

The `date_when()` function gives the date when a certain week of pregnancy will (or was) reached,
and the duration of that date from today:

```{r}
date_when(28, due_date = due_date)
```

By default, the output messages are in the second person, i.e. addressed to "you",
but there is also an option to specify another person.
A value of `1` or `"I"` means you'll be addressed in the first person:

```{r}
how_far(due_date = due_date, person = 1)
```

Any other character string will be interpreted as a third-person name,
which is useful, for example, if you're following the pregnancy progress of a partner.


```{r}
date_when(6, due_date = due_date, person = "Ruth")
```

## Tracking medications

*Write this section!*

## Global options

It would be very tedious to have to enter a due date every time you call `how_far()` or `date_when()` over the course of a pregnancy, especially since that date is constant throughout. 
Similarly for the medications table in `medications_remaining()`.
To avoid this, the pregnancy package makes use of **global options**, 
which can be set with the `set_*` family of functions, 
retrieved with the `get_*` family of functions.
Any global option can be unset by calling its `set_*` function with the argument `NULL`.

### `pregnancy.due_date`

You can set the `pregnancy.due_date` option using the `set_due_date()` function.
When that option is set, if the `due_date` argument to `how_far()` or `date_when()` is `NULL` (the default),
that option is retrieved. 

`set_due_date()` only sets the due date for the current R session. 
To make this option persist (recommended), it can be added to your `.RProfile`. 
The console output of `set_due_date()` provides guidance on how to do this.

```{r}
set_due_date(due_date)
```

Then `how_far()` can be called without needing to specify any arguments, 
and `date_when()` only needs the target week:

```{r}
how_far()
```

To check what the option is set to, use `get_due_date()`.

### `pregnancy.person`

`set_person()` sets the global option `pregnancy.person`. 
If this option is set it will be retrieved to specify the value of `person` in `how_far()` and `date_when()`,
unless it is overriden by passing another value directly to the `person` argument. 
If the option is not set, the default second-person will be used.

```{r}
set_person(1)
how_far()
set_person(NULL) # TODO: update output to reflect that option has been unset
how_far()
```

### `pregnancy.medications`

*Write this section!*

### An example `.RProfile`

Taking the advice to specify the options in your `.RProfile`, 
here's an example of what you might include in that file:

``` r
# TODO
```

